Assume  CS: Code, DS: Code
Code 	SEGMENT
	org 	100h
	.286
Start 	proc 	near 	; Основная процедура
	mov 	ax,cs
	mov 	ds,ax 	; DS = CS
	jmp 	beg 	; "Перескок" через переменные
frequency 	equ 	0500h 	; Коэффициент деления
iniflag 	db 	0 		; Флаг звучания
old_int1c_off    dw    0 		; Смещение старого вектора
old_int1c_seg  dw    0 		; Сегмент старого вектора
beg:		; Сохранение старого вектора прерывания 1Сh
	mov 	ax,35h 	; Функция взятия вектора
	mov 	al,1ch 	; Вектор 1Сh
	int 	21h 		; Вызов функции DOS
	mov 	cs:old_int1c_off,bx 	; Запись смещения
	mov 	cs:old_int1c_seg,es 	; Запись сегмента
; Установка в вектор прерывания адреса новой
; программы обработки прерывания
	lea 	dx,new_int1c 	; Запись нового вектора 1c
	mov 	ah,25h 		; Функция установки вектора прерыв.
	mov 	al,1ch 		; Номер вектора прерывания
	int 	21h 		; DS:DX - адрес новой программы обр.
beg1: call	kbin 		; Опрос клавиатуры
	cmp 	al,'1' 		; = '1' ?
	jnz 	beg2 		; Нет
	mov 	byte ptr iniflag,1 	; Взведение флага звуч.
	jmp 	beg1 		; Переход на начало цикла
beg2: cmp 	al,'2' 		; = '2' ?
	jnz 	beg3 		; Нет
	mov 	byte ptr iniflag,0 	; Сброс флага звуч.
	jmp 	beg1 		; Переход на начало цикла
beg3: cmp 	al,'q' 		; = 'q' ?
	jnz 	beg1 		; Нет
; Восстановление старого вектора 1с и выход
	mov 	dx,old_int1c_off 	; Смещение старого вектора
	mov 	ax,old_int1c_seg 	; Сегмент старого вектора
	mov 	ds,ax 			; DS:DX - адрес устанавл. вектора
	mov 	ax,251ch 		; Установка старого вектора 1ch
	int 	21h 			; Вызов функции DOS
	int 	20h 			; Выход из программы
start 	endp 		; Конец основной процедуры
; Новый обработчик прерывания 1ch
new_int1c 	proc 	far 	; Дальняя процедура
		pusha 	; Сохранение всех регистров (для Intel286)
		call	muz	 ; Вызов процедура извлечения звука
		popa 		; Восстановление всех регистров
		iret 		; Возврат из программы обработки прерывания
new_int1c 	endp 		; Конец нового обработчика прерывания 1сh
muz	proc 	near 	; Процедура генерации звука
	test 	byte ptr cs:iniflag,0ffh 	; Проверка флага
	jnz 	muz1 	; Продолжение
	in 	al,61h 	; Чтение системного порта В
	and 	al,0fch 	; Запрещение звучания (биты 0 и 1)
	out 	61h,al 	; Запись в системный порт В
	ret			; Выход, если флаг не взведен
muz1:			; Программирование делителя частоты 2 канала
	mov 	ax,frequency 	; Делитель частоты
	out 	42h,al 		; Мл.байт частоты ? канал 2 таймера
	xchg 	al,ah 			; AH ? AL
	out 	42h,al 		; Ст.байт частоты ? канал 2 таймера
; Разрешение звучания
	in 	al,61h 	; Чтение системного порта В
	or 	al,3 		; Разрешение звучания (биты 0 и 1)
	out 	61h,al 	; Запись в системный порт В
	ret 			; Нормальный выход
muz 	endp 			; Конец процедуры генерации звука
kbin 	proc 	near 		; Ввод с клавиатуры и проверка на выбор игры
; Процедура совпадает с одноименной в задаче 2.4.2.1.
kbin 	endp
code 	ends 			; Конец сегмента (кодового)
	END 	Start 		; Указание на точку входа
